{% extends 'base.html' %}

{% block title %}/{{ board.id }}/ - {{ board.title }} No.{{ thread_id }}{% endblock %}

{% block meta %}{# Hide contents until script is ready. #}
<script>document.documentElement.className='not-ready'</script>
<style>.not-ready{visibility:hidden}</style>
{{ super() }}

<meta name="robots" content="noarchive">
<link rel="canonical" href="{{ SITE_URL }}{{ url_for('thread', board_id=board.id, thread_id=thread_id) }}">
<meta id="meta-thread" name="thread-id" value="{{ board.id }}-{{ thread_id }}">
{% endblock %}

{% block content %}
<h3>Replies</h3>

<div class="row threadinfo">
  <nav>
    [<a href="{{ url_for('board', board_id=board.id) }}">Return</a>]
    [<a href="#bottom">Bottom</a>]
    [<a href="javascript:update()">Update</a>]
  </nav>
  <div class="thread-info">
    {{ thread_replies }} Replies
  </div>
</div>

{% for post in posts -%}
<article id="id{{ post.id }}" class="js-post
    {%- if post.data.signature == 'ENCRYPTED' %} encrypted{% endif %}"
  data-signature="{{ post.data.signature }}"
  data-pubsign="{{ post.data.pubsign }}"
  data-pubkey="{{ post.data.pubkey }}">
  <div class="info">
    {% if thread_subject and loop.first %}
      <strong>{{ thread_subject }}</strong>
    {% endif %}
    <time>{{ post.date.strftime('%Y-%m-%d %H:%M:%S') }}</time>
    <span class="badge">{{ post.data.pubsign[0:10] }}</span>
    <span class="postid">
      <a href="#id{{ post.id }}">No.</a><a class="js-reply" data-id="{{ post.id }}" href="#">{{ post.id }}</a>
    </span>
  </div>
  <p class="reply-text js-text">{{ post.data.text }}</p>
  {% if post.data.signature == 'ENCRYPTED' %}
    <p class="encrypted-info"><em class="meta">Encrypted message.</em></p>
  {% endif %}
</article>
<hr>
{% endfor %}

<div class="row threadinfo">
  <nav>
    [<a href="{{ url_for('board', board_id=board.id) }}">Return</a>]
    [<a href="#top">Top</a>]
    [<a href="javascript:update()">Update</a>]
  </nav>
  <div class="thread-info">
    {{ thread_replies }} Replies
  </div>
</div>

{% if thread_replies >= MAX_REPLIES %}
  <h4>Reply limit reached.</h4>
{% else %}
<form method="post" class="js-form">
  <h4><abbr>R</abbr>eply:</h4>
  <textarea id="form-text" rows="6" cols="40" accesskey="r" tabindex="0" placeholder="Comment" required></textarea><br>
  {%- if RECAPTCHA -%}<div class="g-recaptcha" data-sitekey="{{ RECAPTCHA_KEY }}"></div>{%- endif %}
  <button type="submit" accesskey="s" tabindex="0">Po<abbr>s</abbr>t reply</button>
  <label class="small">
    <input type="checkbox" id="form-encrypt"> Encrypt to mentioned posters.
  </label>
  <input type="hidden" name="data" id="form-data">
</form>
{% endif %}
{% endblock %}
